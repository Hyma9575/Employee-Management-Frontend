<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Home - Dashboard</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
	rel="stylesheet" />
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
	rel="stylesheet" />
<style>
:root {
	--sidebar-width: 250px;
	--transition-speed: 0.3s;
}

body {
	background-color: #f8f9fa;
	transition: all var(--transition-speed) ease;
}

body.dark-mode {
	background-color: #121212;
	color: #f1f1f1;
}

.dark-mode .card {
	background-color: #1f1f1f;
	border-color: #333;
}

.dark-mode .sidebar {
	background-color: #1a1a1a;
	border-right: 1px solid #333;
}

.dark-mode .nav-link {
	color: #f1f1f1;
}

.dark-mode .nav-link:hover {
	background-color: #333;
}

.dark-mode .nav-link.active {
	background-color: #0d6efd;
}

.sidebar {
	width: var(--sidebar-width);
	height: 100vh;
	position: fixed;
	left: 0;
	top: 0;
	background-color: #fff;
	border-right: 1px solid #dee2e6;
	padding-top: 20px;
	transition: all var(--transition-speed) ease;
	z-index: 1000;
}

.main-content {
	margin-left: var(--sidebar-width);
	padding: 20px;
	transition: all var(--transition-speed) ease;
}

.navbar {
	padding-left: var(--sidebar-width);
	transition: all var(--transition-speed) ease;
}

.navbar-dark-mode {
	background-color: #1f1f1f !important;
}

.nav-link {
	padding: 10px 15px;
	margin: 5px 10px;
	border-radius: 5px;
	color: #333;
	transition: all 0.2s;
}

.nav-link:hover {
	background-color: #f0f0f0;
}

.nav-link.active {
	background-color: #0d6efd;
	color: white;
}

.nav-link i {
	margin-right: 10px;
}

.btn-toggle-theme {
	border: none;
	background: none;
	cursor: pointer;
}

.dashboard-card {
	transition: transform 0.3s ease;
	cursor: pointer;
}

.dashboard-card:hover {
	transform: translateY(-5px);
}

@media ( max-width : 768px) {
	.sidebar {
		transform: translateX(-100%);
	}
	.sidebar.show {
		transform: translateX(0);
	}
	.main-content, .navbar {
		margin-left: 0;
		padding-left: 15px;
	}
	.navbar-toggler {
		display: block !important;
	}
}

.navbar-toggler {
	display: none;
	position: fixed;
	left: 10px;
	top: 10px;
	z-index: 1100;
}
</style>
</head>
<body>
	<!-- Sidebar Toggle Button (Mobile) -->
	<button class="navbar-toggler btn btn-primary"
		onclick="toggleSidebar()">
		<i class="bi bi-list"></i>
	</button>

	<!-- Sidebar Navigation -->
	<div class="sidebar">
		<div class="d-flex flex-column h-100">
			<div class="text-center mb-4">
				<h4>
					<i class="bi bi-house-door-fill me-2"></i>Dashboard
				</h4>
			</div>

			<ul class="nav flex-column flex-grow-1">
				<li class="nav-item"><a class="nav-link active" href="#"> <i
						class="bi bi-speedometer2"></i> Dashboard
				</a></li>
				<li class="nav-item"><a class="nav-link"
					href="project-list.html"> <i class="bi bi-folder"></i> Projects
				</a></li>
				<li class="nav-item"><a class="nav-link" href="team-list.html">
						<i class="bi bi-people"></i> Teams
				</a></li>
				<li class="nav-item"><a class="nav-link"
					href="employee-list.html"> <i class="bi bi-person-lines-fill"></i>
						Employees
				</a></li>
				<li class="nav-item"><a class="nav-link"
					href="employee-form.html"> <i class="bi bi-person-plus"></i>
						Add Employee
				</a></li>
				<li class="nav-item"><a class="nav-link" href="index.html">
						<i class="bi bi-person-plus"></i> Home
				</a></li>
				<li class="nav-item"><a class="nav-link"
					href="leave-requests.html"> <i class="bi bi-inbox"></i> Leave
						Requests <span class="badge bg-danger rounded-pill ms-2"
						id="leaveNotificationBadge"></span>
				</a></li>
			</ul>

			<div class="p-3">
				<button class="btn-toggle-theme w-100" onclick="toggleTheme()">
					<i class="bi bi-moon-stars-fill me-2"></i> Switch Theme
				</button>
			</div>
		</div>
	</div>

	<!-- Main Content -->
	<div class="main-content">
		<div class="container-fluid">
			<h1 id="welcomeMessage" class="mb-4"></h1>
			<p class="lead mb-5">Welcome to the Employee Management System.
				Manage your employees, projects, and teams efficiently.</p>

			<div class="row">
				<div class="col-md-4 mb-4">
					<div class="card dashboard-card h-100"
						onclick="location.href='project-list.html'">
						<div class="card-body text-center">
							<i class="bi bi-folder fs-1 text-primary mb-3"></i>
							<h3>Projects</h3>
							<p class="text-muted">Manage and track all your projects</p>
						</div>
					</div>
				</div>

				<div class="col-md-4 mb-4">
					<div class="card dashboard-card h-100"
						onclick="location.href='team-list.html'">
						<div class="card-body text-center">
							<i class="bi bi-people fs-1 text-success mb-3"></i>
							<h3>Teams</h3>
							<p class="text-muted">Organize your teams and members</p>
						</div>
					</div>
				</div>

				<div class="col-md-4 mb-4">
					<div class="card dashboard-card h-100"
						onclick="location.href='employee-list.html'">
						<div class="card-body text-center">
							<i class="bi bi-person-lines-fill fs-1 text-info mb-3"></i>
							<h3>Employees</h3>
							<p class="text-muted">View and manage employee details</p>
						</div>
					</div>
				</div>
			</div>

			<div class="col-md-6 mb-4">
				<div class="card">
					<div class="card-header">
						<h5>Quick Actions</h5>
					</div>
					<div class="card-body">
						<div class="d-grid gap-2">
							<button class="btn btn-primary"
								onclick="location.href='employee-form.html'">
								<i class="bi bi-person-plus me-2"></i>Add New Employee
							</button>
							<button class="btn btn-success"
								onclick="location.href='project-list.html'">
								<i class="bi bi-plus-circle me-2"></i>Create New Project
							</button>
							<button class="btn btn-info"
								onclick="location.href='team-list.html'">
								<i class="bi bi-people-fill me-2"></i>Manage Teams
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script>
		// Welcome message based on time
		function setWelcomeMessage() {
			const hour = new Date().getHours();
			let message = "Welcome!";
			if (hour < 12) {
				message = "Good Morning!";
			} else if (hour < 18) {
				message = "Good Afternoon!";
			} else {
				message = "Good Evening!";
			}
			document.getElementById("welcomeMessage").textContent = message;
		}

		// Theme toggle
		function toggleTheme() {
			document.body.classList.toggle("dark-mode");
			document.querySelector(".sidebar").classList.toggle("dark-mode");
		}

		// Sidebar toggle for mobile
		function toggleSidebar() {
			document.querySelector(".sidebar").classList.toggle("show");
		}

		// Initialize
		setWelcomeMessage();

		// Close sidebar when clicking outside on mobile
		document.addEventListener('click', function(event) {
			const sidebar = document.querySelector('.sidebar');
			const toggler = document.querySelector('.navbar-toggler');

			if (window.innerWidth <= 768 && !sidebar.contains(event.target)
					&& event.target !== toggler) {
				sidebar.classList.remove('show');
			}
		});
		
		async function loadPendingLeaveCount() {
	        try {
	            const token = await auth0Client.getTokenSilently();
	            const response = await fetch(`${API_BASE_URL}/leaves/pending/count`, {
	                headers: {
	                    'Authorization': `Bearer ${token}`
	                }
	            });
	            
	            if (response.ok) {
	                const count = await response.json();
	                const badge = document.getElementById('leaveNotificationBadge');
	                if (count > 0) {
	                    badge.textContent = count;
	                    badge.style.display = 'inline-block';
	                } else {
	                    badge.style.display = 'none';
	                }
	            }
	        } catch (error) {
	            console.error("Error loading pending leave count:", error);
	        }
	    }

	    // Call this function after initializing Auth0
	    if (isAdmin) {
	        loadPendingLeaveCount();
	        // Refresh every 5 minutes
	        setInterval(loadPendingLeaveCount, 5 * 60 * 1000);
	    }
	</script>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
